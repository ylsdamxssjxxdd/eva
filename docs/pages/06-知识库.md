# 06 知识库：你的私有仓库

[返回总览](GitHubPages用户引导.md) · [上一页：文生图](05-文生图.md) · [下一页：MCP](07-MCP.md)

## 你能完成
- 将私有文档转成向量库，模型回答时引用而非凭空编造。
- 在对话中自动检索 Top-N 片段并回填，再由模型生成最终答案。
- 按需清库、重建或补充新文档，保持资料新鲜。

## 开始前
- 打开“增殖-知识库”，选择嵌入模型并点击启动（llama.cpp `--embedding` 模式，默认会尽量使用 GPU offload）。
- 准备文档：txt/md/doc/docx/xlsx/pptx/html/代码等，EVA 会用 doc2md 转成 Markdown 再入库；建议分段/章节，便于检索。
- 在“约定”面板勾选“知识库”工具，保存后会重置上下文并把工具描述写入系统提示。

## 操作步骤
1. **入库**：在“增殖-知识库”上传或粘贴文本，按段提交。后台会调用 `/v1/embeddings` 获取向量，自动记录维度并写入本地向量库。
2. **启用工具**：在“约定”勾选“知识库”，保存并重置；系统提示会带上检索说明和停用词。
3. **提问**：回到对话输入问题，模型若需要知识会输出工具调用，EVA 自动检索并以 `tool_response:` 回填匹配片段。
4. **继续追问**：同一会话中知识库保持可用，直到关闭工具或重置对话。

## 小技巧
- 让模型“只依据引用回答并标注来源/匹配度”，可减少幻觉。
- 对比多文档时，在问题里指明文档名或关键段落；分批入库时注意命名。
- 入库失败或维度异常时，重启嵌入服务并清空向量库再导入。

## 常见问题
- **无匹配**：确认嵌入服务已启动、文档已入库；可调大 Top-N 或检查分段是否过大/过散。
- **维度不符**：查看嵌入服务日志确认维度，模型更换后需重建库。
- **回答偏离事实**: 要求先列引用片段再总结；必要时关闭工具确认是否是知识库内容不完整。

![知识库页面示意](../images/pages/06-rag.png)
