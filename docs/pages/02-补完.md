# 02 补完：初始形态

补完状态下机体会失去自己的力场，彻底成为预测下一个词的机器

## 适用场景
- 长文续写、邮件/报告/方案一键补全，避免多轮往返。
- 代码片段/注释补全，或“说一句，出一段”的快速草稿。
- 希望和多轮对话隔离，单次生成不带历史记忆。

## 补完模式的工作方式（基于 xNet 与 widget_toolflow 实现）
- 输出区全文会直接作为 `prompt` 走 `/v1/completions`，不带系统提示、历史消息与工具描述；采样参数沿用设置页的温度/top_p/repeat/n_predict，链接模式会把 `n_predict` 透传为 `max_completion_tokens`。
- 不触发工具链：`<tool_call>` 解析在补完模式被跳过，如需工具请改用“对话”模式。
- 单轮完成后自动重置：收到回复即 `normal_finish_pushover()`，随后 `on_reset_clicked()` 清理上下文与记录条；输出区文本会保留、输入框重新置灰，便于在原文上继续修改后再补完。
- 停用词有效：在“约定”里设置的额外 stopwords 会写入请求的 `stop` 数组，可用于控制收尾。

## 开始前
- 已按《对话》页跑通装载（本地或链接模式均可）。
- 打开 **“设置”**，选择“补完模式”单选，点击确定。此时输入框变为只读、占位提示为“Please modify any text above”，发送按钮文案变为“complete”，输出区获得焦点。
- 建议参数：温度 0.3~0.6（降低发散），`n_predict` 设定希望的输出长度；需要强制收尾可在“约定”添加停用词。

## 操作步骤（照做即可）
1) **进入补完模式**：如上切换后，确认状态灯为“正常”，按钮均可点。
2) **准备文本**：在输出区粘贴/编辑待续写的正文。若需提纲，可先在“对话”模式生成，再复制到这里；补完模式不会发送图片/音频/文档。
3) **控制长度与停点**：在“设置”里调整 `n_predict`；若要在特定标记处停下，可在文本末尾加入提示或将停用词写入“约定”。
4) **发送与收尾**：按 `Ctrl+Enter` 或点击“complete”。流式展示完毕后会自动重置上下文和记录条，但生成内容仍保留在输出区，方便直接修改后再次补完。
5) **保存/复用**：满意后复制到目标文档；若想继续讨论，可切回“对话”模式并将结果粘贴为新消息。

## 小技巧
- 代码补全：在开头写清语言/文件名/函数名，模型更容易保持风格；需要续写多段时在末尾标注“到此结束”防止越界。
- 控制篇幅：`n_predict` 太小会截断，太大容易跑题；可以结合停用词或在文末加“请在 200 字内收尾”。
- 先总结再补完：长输入可先用“对话”模式让模型总结要点，再把摘要贴回补完，提高聚焦度。

## 常见问题
- **输出过短**：提升 `n_predict`，或在提示中要求“生成完整段落/完整函数”。
- **输出跑题**：在正文开头补充“上下文/目标”，或先用“对话”模式做摘要再补完。
- **想多轮对话**：补完模式每轮都会重置上下文且不存历史，需切回“对话”保持记忆。
- **没看到回复**：确认仍在“正常”状态灯；补完模式不展示工具错误，如无流式输出多为端点/参数问题，可先按《对话》页的排查步骤检查网络与模型。

![补完页面示意](../images/pages/02-completion.png)

[返回总览](../index.md) · [上一页：对话](01-对话.md) · [下一页：语音交互](03-语音交互.md)
